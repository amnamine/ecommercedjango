{% extends 'base.html' %}
{% block title %}{{ product.name }} · E‑Shop{% endblock %}
{% block content %}
<div class="detail">
  <img class="detail-img-el hover-rise" src="{{ product.image_url }}" alt="{{ product.name }}" onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22600%22 height=%22360%22><rect width=%22600%22 height=%22360%22 fill=%22%230b1222%22/><text x=%2250%25%22 y=%2250%25%22 fill=%22%238aa0b6%22 font-size=%2232%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>Image unavailable</text></svg>'" />
  <div class="detail-info slide-up">
    <h1 class="h2">{{ product.name }}</h1>
    <p class="muted">{{ product.description }}</p>
    <p class="price">${{ product.price }}</p>
    <p class="muted">Avg rating: {{ avg|floatformat:1 }}/5</p>
    <div class="actions">
      <a class="btn" href="{% url 'shop:add_to_cart' product.id %}">Add to cart</a>
      <a class="btn outline" href="{% url 'shop:wishlist_add' product.id %}">Wishlist</a>
    </div>
  </div>
</div>

<section class="reviews">
  <h3 class="h2">Reviews</h3>
  {% for r in reviews %}
    <div class="card">
      <div class="card-body">
        <strong>{{ r.user.username }}</strong>
        <span class="muted">rated {{ r.rating }}/5</span>
        <p>{{ r.text }}</p>
      </div>
    </div>
  {% empty %}
    <p class="muted">No reviews yet.</p>
  {% endfor %}
  {% if user.is_authenticated %}
  <form method="post" action="{% url 'shop:add_review' product.id %}" class="form card">
    {% csrf_token %}
    <label>Rating</label>
    <select name="rating">
      <option>5</option><option>4</option><option>3</option><option>2</option><option>1</option>
    </select>
    <label>Review</label>
    <textarea name="text"></textarea>
    <button class="btn" type="submit">Submit review</button>
  </form>
  {% else %}
    <p class="muted">Login to add a review.</p>
  {% endif %}
</section>
{% endblock %}
